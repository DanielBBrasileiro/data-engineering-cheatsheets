<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NumPy Cheatsheet for Data Engineers</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; -webkit-print-color-adjust: exact; }
        code { font-family: 'JetBrains Mono', monospace; }
        
        /* Diagramas CSS para Broadcasting */
        .array-box {
            display: grid;
            gap: 2px;
            padding: 4px;
            background: #e0f2f1;
            border-radius: 4px;
            width: fit-content;
        }
        .cell {
            width: 20px;
            height: 20px;
            background: #009688;
            opacity: 0.8;
            border-radius: 2px;
        }
        .cell-ghost {
            background: #b2dfdb;
            border: 1px dashed #009688;
            opacity: 0.5;
        }

        @media print {
            body { background: white; margin: 0; padding: 0; font-size: 11px; }
            .container { max-width: 100% !important; margin: 0; padding: 0.5cm; }
            .no-print { display: none; }
            .card { break-inside: avoid; border: 1px solid #ccc; box-shadow: none; }
            h1 { font-size: 18pt; }
        }
        
        pre { margin: 0.25rem 0 !important; padding: 0.5rem !important; font-size: 0.75rem !important; line-height: 1.2 !important; }
        .token.comment { color: #8b9bb4; font-style: italic; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 md:p-8">

    <div class="max-w-6xl mx-auto container bg-white shadow-xl min-h-screen p-6 md:p-8 rounded-lg">
        
        <!-- Header -->
        <header class="border-b-4 border-teal-600 pb-4 mb-6 flex justify-between items-start">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 tracking-tight">NumPy <span class="text-teal-600">Data Engineer</span> Edition</h1>
                <p class="text-sm md:text-base text-gray-600 mt-1 font-medium">Vectorization • Broadcasting • Memory Layout • Linear Algebra</p>
            </div>
            <div class="flex gap-2 text-xs font-bold uppercase tracking-wider">
                <span class="bg-teal-100 text-teal-800 px-2 py-1 rounded">Core</span>
                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">Fast C</span>
                <span class="bg-gray-200 text-gray-800 px-2 py-1 rounded">No Loops</span>
            </div>
        </header>

        <!-- VISUAL CONCEPT: BROADCASTING -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <section class="card bg-white border rounded-lg overflow-hidden p-4">
                <h2 class="font-bold text-sm uppercase text-gray-500 mb-2">O Poder do Broadcasting</h2>
                <div class="flex items-center gap-4 text-xs">
                    <div class="flex flex-col items-center">
                        <span class="mb-1 font-bold">(3, 1)</span>
                        <div class="array-box">
                            <div class="cell"></div><div class="cell"></div><div class="cell"></div>
                        </div>
                    </div>
                    <span class="text-xl font-bold text-gray-400">+</span>
                    <div class="flex flex-col items-center">
                        <span class="mb-1 font-bold">(3,)</span>
                        <div class="array-box" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="cell"></div><div class="cell"></div><div class="cell"></div>
                        </div>
                    </div>
                    <span class="text-xl font-bold text-gray-400">=</span>
                    <div class="flex flex-col items-center">
                        <span class="mb-1 font-bold">(3, 3)</span>
                        <div class="array-box" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="cell"></div><div class="cell-ghost"></div><div class="cell-ghost"></div>
                            <div class="cell-ghost"></div><div class="cell"></div><div class="cell-ghost"></div>
                            <div class="cell-ghost"></div><div class="cell-ghost"></div><div class="cell"></div>
                        </div>
                    </div>
                </div>
                <p class="mt-2 text-xs text-gray-600">O NumPy "estica" automaticamente arrays menores para combinar dimensões sem copiar dados na memória.</p>
            </section>
            
            <section class="card bg-white border rounded-lg overflow-hidden p-4 flex flex-col justify-center">
                <h2 class="font-bold text-sm uppercase text-gray-500 mb-2">Setup Recomendado</h2>
                <pre><code class="language-python">import numpy as np

# Seed para reprodutibilidade em testes
np.random.seed(42)

# Configurar print para não truncar arrays pequenos
np.set_printoptions(precision=2, suppress=True)</code></pre>
            </section>
        </div>

        <!-- Grid Layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

            <!-- COLUMN 1: Arrays & Memory -->
            <div class="space-y-6">
                
                <!-- CREATION -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">1. Criação & Inicialização</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">ndarray</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <p class="text-xs text-gray-600 mb-1">Evite listas Python. Use arrays tipados.</p>
                        <pre><code class="language-python"># Do zero (Mais rápido que converter lista)
arr = np.arange(1000) # [0, 1, ..., 999]
arr = np.linspace(0, 1, 11) # 11 pontos entre 0 e 1

# Placeholders (Alocação de memória)
zeros = np.zeros((100, 100), dtype='int8') # Economia RAM
ones = np.ones((5, 5))
full = np.full((3, 3), 99)

# Identidade (Álgebra Linear)
eye = np.eye(4)</code></pre>
                    </div>
                </section>

                <!-- DTYPES & MEMORY -->
                <section class="card bg-white border rounded-lg overflow-hidden ring-2 ring-teal-600">
                    <div class="bg-teal-700 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">2. Tipos e Memória (Crítico)</h2>
                        <span class="text-xs bg-teal-800 px-2 rounded">Optimization</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <p class="text-xs text-gray-600 mb-1">O tipo padrão é `int64`/`float64`. Reduzir para `32` ou `16` economiza gigabytes.</p>
                        <pre><code class="language-python"># Verificar consumo
print(arr.nbytes / 1024, "KB")

# Downcasting (Reduzir memória com segurança)
arr_small = arr.astype(np.int16) # -32k a 32k
arr_float = arr.astype(np.float32) # Standard para ML

# NaN (Not a Number) só existe em Float!
# np.array([1, np.nan], dtype='int') -> ERRO
arr_nan = np.array([1, np.nan], dtype='float32')</code></pre>
                    </div>
                </section>

                <!-- SHAPE MANIPULATION -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">3. Dimensões & Reshape</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">ETL Prep</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <pre><code class="language-python">arr = np.arange(12)

# Mudar formato (Sem copiar dados)
mat = arr.reshape(3, 4) # 3 linhas, 4 colunas
flat = mat.flatten()    # Volta para 1D (Cópia)
ravel = mat.ravel()     # Volta para 1D (View - Rápido)

# Transposta (Linhas <-> Colunas)
T = mat.T 

# Adicionar dimensão (Útil para modelos que exigem batch)
# De (10,) para (10, 1)
vec_col = arr[:, np.newaxis] </code></pre>
                    </div>
                </section>

                <!-- INDEXING -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">4. Indexação Avançada</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">Filtering</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <pre><code class="language-python"># Slicing [start:stop:step]
# arr[linhas, colunas]
subset = mat[:2, 1:3] 

# Boolean Masking (Vetorizado)
mask = mat > 5
filtered = mat[mask] # Retorna array 1D

# Fancy Indexing (Seleção por índices específicos)
# Pega linhas 0 e 2
selected = mat[[0, 2], :] </code></pre>
                    </div>
                </section>
            </div>

            <!-- COLUMN 2: Operations & Algebra -->
            <div class="space-y-6">

                <!-- VECTORIZATION -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">5. Vetorização (Sem Loops)</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">Speed</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <p class="text-xs text-gray-600 mb-1">Operações aplicadas element-wise. 100x mais rápido que loops.</p>
                        <pre><code class="language-python"># Aritmética simples
res = arr * 10 + 5 

# Funções Universais (ufuncs) - Otimizadas em C
np.log(arr)
np.exp(arr)
np.sqrt(arr)

# Operações entre arrays (Element-wise)
# Requer shapes compatíveis ou broadcastáveis
diff = arr_a - arr_b</code></pre>
                    </div>
                </section>

                <!-- AGGREGATIONS -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">6. Estatística & Agregação</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">Axis Logic</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <div class="bg-blue-50 p-2 rounded text-xs border-l-4 border-blue-500 mb-2">
                            <strong>Axis 0:</strong> Reduz as linhas (Resultado = Colunas).<br>
                            <strong>Axis 1:</strong> Reduz as colunas (Resultado = Linhas).
                        </div>
                        <pre><code class="language-python"># Agregações Básicas
mat.sum()          # Soma tudo
mat.mean(axis=0)   # Média de cada coluna
mat.max(axis=1)    # Máximo de cada linha

# Posição do Mínimo/Máximo
idx = np.argmax(arr) # Índice do maior valor

# Estatística
np.std(arr)        # Desvio Padrão
np.percentile(arr, 95) # Percentil 95</code></pre>
                    </div>
                </section>

                <!-- CONDITIONAL LOGIC -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">7. Lógica Condicional</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">SQL Case</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <p class="text-xs text-gray-600 mb-1">Essencial para limpeza de dados (Feature Engineering).</p>
                        <pre><code class="language-python"># np.where(condição, valor_se_sim, valor_se_nao)
# Ex: Substituir negativos por 0
clean = np.where(arr < 0, 0, arr)

# np.select (Múltiplas condições - Switch Case)
conds = [arr < 0, arr > 10]
choices = [0, 10]
clipped = np.select(conds, choices, default=arr)</code></pre>
                    </div>
                </section>

                <!-- RANDOM & SAMPLING -->
                <section class="card bg-white border rounded-lg overflow-hidden">
                    <div class="bg-slate-800 text-white px-4 py-2 flex justify-between items-center">
                        <h2 class="font-bold text-sm uppercase">8. Aleatoriedade</h2>
                        <span class="text-xs bg-slate-700 px-2 rounded">Simulation</span>
                    </div>
                    <div class="p-4 space-y-3">
                        <pre><code class="language-python"># Distribuições
norm = np.random.normal(0, 1, 1000) # Gaussiana
unif = np.random.uniform(0, 10, 100)

# Sampling (Bootstrapping)
# Escolhe 3 itens de 'arr' com reposição
sample = np.random.choice(arr, 3, replace=True)

# Shuffle (In-place)
np.random.shuffle(arr)</code></pre>
                    </div>
                </section>

            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 pt-4 border-t border-gray-200 text-center text-xs text-gray-500">
            <p><strong>Pro Tip:</strong> O Pandas é construído sobre o NumPy. Se uma operação Pandas estiver lenta (`apply`), tente extrair os dados com `.values` (retorna numpy array), vetorizar a operação no NumPy e devolver para o DataFrame.</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</body>
</html>
